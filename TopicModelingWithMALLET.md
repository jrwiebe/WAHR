# Topic Modeling with MALLET

## Import Documents
The _datescrapes_ directory named here contained all the texts of a collection
of web archives, split into files by date of the web scrape. The date is
indicated by the filename (YYYYMM.txt). These files were generated by the
script [break-into-date-scrapes.py](https://github.com/ianmilligan1/WAHR/blob/master/text-analysis/break-into-date-scrapes.py).

This script takes as input files in the format
```
YYYYMM   domain.ext  Text of the web page.
```
The first two columns (date and domain) are not relevant for topic-modeling
purposes, and might negatively affect the topic model. They could be
removed by adding code to `break-into-date-scrapes.py`, this is also 
effective.

```
# Go into datescrape directory, and create new dir
$ cd datescrapes
$ mkdir justtext
# Select fields three and on using `cut`
$ for i in *.txt; do cat $i | cut -f 3- > justtext/$i ; done
```

Import data into MALLET's internal format. E.g.,

```
./bin/mallet import-dir --input /cliphomes/jrwiebe/cpp.text-greenparty/datescrapes/ --output /cliphomes/jrwiebe/mallet-data/greenparty.mallet --keep-sequence --remove-stopwords
```

## Building Topic Models
```
./bin/mallet train-topics  --input /cliphomes/jrwiebe/mallet-data/greenparty.mallet  --num-topics 20 --optimize-interval 20 --num-threads 16 --output-state /cliphomes/jrwiebe/mallet-data/greenparty-topic-state.gz  --output-topic-keys /cliphomes/jrwiebe/mallet-data/mallet-data/greenparty_keys.txt --output-doc-topics /cliphomes/jrwiebe/mallet-data/mallet-data/greenparty_composition.txt
```

## Transform Topic Composition Document
MALLET's `--output-doc-topics` option produces a tab-separated file with
columns for document number, source (document filename), and a series
of topic number/proportion column-pairs in no logical order. The script 
[doctopic-matrix.py](https://github.com/jrwiebe/WAHR/blob/master/doctopic-matrix.py)
produces a CSV file with columns _docname_ and _topic1_, ..., _topicN_.
This can then be more easily analyzed and visualized.
